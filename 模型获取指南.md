# Deep-Live-Cam 模型获取指南

## 概述

Deep-Live-Cam需要以下ONNX模型文件才能正常工作。由于模型文件较大，提供多种获取方式。

## 必需模型

### 核心模型 (必须)
1. **inswapper_128.onnx** (554MB) - 换脸生成模型
2. **scrfd_10g_bnkps.onnx** (16.9MB) - 人脸检测模型  
3. **arcface_r100.onnx** (248MB) - 人脸识别模型

### 可选模型 (增强功能)
4. **bisenet_face.onnx** (33.2MB) - 人脸分割模型
5. **w600k_r50.onnx** (166MB) - 轻量级人脸识别模型

## 获取方式

### 方式1: 使用InsightFace自动下载 (强烈推荐)

**这是最可靠的方式，官方支持，成功率最高**

```bash
# 1. 安装InsightFace
pip install insightface

# 2. 运行Python代码自动下载所有模型
python -c "
import insightface
print('正在下载InsightFace模型包...')
# 下载buffalo_l模型包 (包含检测和识别模型)
app = insightface.app.FaceAnalysis(name='buffalo_l')
app.prepare(ctx_id=-1, det_size=(640, 640))
print('buffalo_l模型包下载完成')

# 下载inswapper换脸模型
from insightface.model_zoo import get_model
print('正在下载InSwapper模型...')
swapper = get_model('inswapper_128.onnx', download=True, download_zip=True)
print('InSwapper模型下载完成')
"

# 3. 复制模型到项目目录
# 模型会自动下载到 ~/.insightface/models/
# 然后复制到项目的 models/ 目录
```

**模型文件位置**:
- Linux/Mac: `~/.insightface/models/`
- Windows: `C:\Users\用户名\.insightface\models\`

### 方式2: 自动下载脚本

```bash
# 使用GUI下载器 (推荐新手)
python scripts/model_downloader_gui.py

# 使用交互式设置
python scripts/quick_setup.py

# 使用命令行下载
python scripts/download_models.py
```

### 方式3: 手动下载 (备用方案)

**注意**: 由于模型文件较大且直接下载链接不稳定，强烈建议优先使用InsightFace自动下载方式。

#### 可用的下载链接

1. **inswapper_128.onnx** (换脸生成模型)
   - https://civitai.com/api/download/models/85159

2. **其他模型** (检测和识别模型)
   - 建议使用InsightFace自动下载，因为直接下载链接经常失效

#### 使用wget/curl下载
```bash
# 创建模型目录
mkdir -p models

# 只下载InSwapper模型 (其他模型建议用InsightFace)
wget -O models/inswapper_128.onnx "https://civitai.com/api/download/models/85159"

# 或使用curl
curl -L -o models/inswapper_128.onnx "https://civitai.com/api/download/models/85159"
```

### 方式4: 从其他项目复制

如果您已经安装了其他换脸项目，可以从以下位置复制模型：

- **InsightFace**: `~/.insightface/models/` (推荐)
- **FaceFusion**: `~/.cache/facefusion/models/`
- **Roop**: `./models/`
- **ComfyUI**: `ComfyUI/models/insightface/`
- **Automatic1111**: `stable-diffusion-webui/models/insightface/`

**复制示例** (Linux/Mac):
```bash
# 从InsightFace复制
cp ~/.insightface/models/buffalo_l/det_10g.onnx models/scrfd_10g_bnkps.onnx
cp ~/.insightface/models/buffalo_l/rec.onnx models/arcface_r100.onnx
cp ~/.insightface/models/inswapper_128.onnx models/
```

## 模型放置

下载完成后，请将模型文件放置到项目的 `models/` 目录：

```
deep-live-cam/
├── models/
│   ├── inswapper_128.onnx
│   ├── scrfd_10g_bnkps.onnx
│   ├── arcface_r100.onnx
│   ├── bisenet_face.onnx (可选)
│   └── w600k_r50.onnx (可选)
└── ...
```

## 验证模型

下载完成后，运行验证脚本确保模型文件完整：

```bash
# 验证所有模型
python scripts/verify_models.py

# 验证特定模型
python scripts/verify_models.py --models inswapper_128.onnx

# 包含推理测试 (更全面但较慢)
python scripts/verify_models.py --test-inference
```

## 故障排除

### 下载失败
1. **网络问题**: 尝试使用VPN或更换网络
2. **链接失效**: 使用备用下载链接
3. **权限问题**: 确保有写入models目录的权限

### 文件损坏
1. **重新下载**: 删除损坏的文件重新下载
2. **校验和验证**: 使用verify_models.py检查文件完整性
3. **手动验证**: 检查文件大小是否与预期一致

### 模型加载失败
1. **检查路径**: 确保模型文件在正确的目录
2. **检查权限**: 确保文件可读
3. **检查格式**: 确保是ONNX格式文件

## 模型信息

### SHA256校验和
- inswapper_128.onnx: `e4a3f08c753cb72d04e10aa0f7dbe3deebbf39567d4ead6dce08e98aa49e16af`
- scrfd_10g_bnkps.onnx: `5838f7fe053675b1c7a08b633df49e7af5495cee0493c7dcf6697200b85b5b91`
- arcface_r100.onnx: `8ffe2b1f775b1c4a15709c5a040b709cfb184d02b204569d36693bbbf47d05d9`

### 模型来源
- **InSwapper**: 基于InsightFace的换脸模型
- **SCRFD**: 高效的人脸检测模型
- **ArcFace**: 高精度人脸识别模型
- **BiSeNet**: 人脸分割模型

## 许可证说明

这些模型来自开源项目，请遵守相应的许可证：
- InsightFace模型: Apache 2.0 License
- 使用时请确保符合学术和商业使用规范

## 联系支持

如果遇到模型下载或使用问题：
1. 查看项目Issues页面
2. 参考操作手册中的故障排除部分
3. 确保遵守模型使用的合规要求
